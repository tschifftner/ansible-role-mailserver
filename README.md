# Ansible Role: mailserver

[![Build Status](https://travis-ci.org/tschifftner/ansible-role-mailserver.svg?branch=master)](https://travis-ci.org/tschifftner/ansible-role-mailserver)

Installs full featured mailserver on Debian/Ubuntu linux servers.

## Important Notice!

This role includes mailserver packages only. Please protect your server with a firewall as well as other security practices!

## Used software

- Postfix
- Dovecot
- Amavis
- Amavisd-Milter
- MariaDb
- Spamassassin
- Razor
- Pyzor
- OpenDKIM

## Requirements

None.

## Role Variables

Available variables are listed below, along with default values (see `defaults/main.yml`):

## OpenDKIM

Define OpenDKIM keys like:
```
mailserver_opendkim_keys:
  - name: key1
    group: default
    private: |
  -----BEGIN RSA PRIVATE KEY-----
  MIIEowIBAAKCAQEA0pTJHL60tSiqt9J2q72bEL/zghEoCh034X/ZfatOkPa8I+EB
  ...
  J97F69OlWisWsDYUgKp0wCivlag7Vboqx9jFq+Coe2SkoYzHU02H
  -----END RSA PRIVATE KEY-----
```

_If private key is not set, the key will be generated and can be found 
in `/etc/opendkim/keys/{{name}}.private` and `/etc/opendkim/keys/{{name}}.txt`_

Signtable can be configured like so:
```
mailserver_opendkim_signingtable:
  - { email: '*@example.org', group: 'default' }
  - { email: '*@example.net', group: 'netkey' }
```

Keytable will be generated by ```mailserver_opendkim_keys```

## Ports

### Mailserver
 - 993	imaps
 - 995 pop3s
 - 110 pop3
 - 143 imap
 - 2000 sieve
 - 25 smtp
 - 587 smtps
 - 12345 dovecot replication
 
### Roundcube 
 - 443 https

## IMAP Test
  - echo exit | telnet localhost 110 | grep 'Connected to localhost.'
  - echo exit | telnet localhost 143 | grep 'Connected to localhost.'
  - echo exit | telnet localhost 993 | grep 'Connected to localhost.'
  - echo exit | telnet localhost 995 | grep 'Connected to localhost.'

  - echo "QUIT;" | openssl s_client -connect 127.0.0.1:993 | grep 'Travis CI Test SSL Certificate'
  - echo "QUIT;" | openssl s_client -connect 127.0.0.1:995 | grep 'Travis CI Test SSL Certificate'

## Check DKIM Signature / SPF Records

Visit [dkimvalidator.com](http://dkimvalidator.com/) and send an email to the given email address. Then check the results.

## Check Mailserver SSL

- https://de.ssl-tools.net/mailservers

## Credits

This role is based on the great tutorial of [Thomas Leister](https://thomas-leister.de/sicherer-mailserver-dovecot-postfix-virtuellen-benutzern-mysql-ubuntu-server-xenial/). 